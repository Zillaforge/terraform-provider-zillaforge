---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "zillaforge_security_group Resource - zillaforge"
subcategory: ""
description: |-
  Manages security groups for VPS instances in ZillaForge. Security groups act as stateful virtual firewalls that control inbound and outbound traffic using protocol, port, and CIDR-based rules. Multiple security groups can be attached to a single instance, with rules evaluated using union logic (most permissive wins).
---

# zillaforge_security_group (Resource)

Manages security groups for VPS instances in ZillaForge. Security groups act as stateful virtual firewalls that control inbound and outbound traffic using protocol, port, and CIDR-based rules. Multiple security groups can be attached to a single instance, with rules evaluated using union logic (most permissive wins).

## Example Usage

```terraform
# Basic security group resource
resource "zillaforge_security_group" "basic" {
  name        = "basic-sg"
  description = "Basic security group with minimal rules"

  ingress_rule {
    protocol    = "tcp"
    port_range  = "22"
    source_cidr = "0.0.0.0/0"
  }

  egress_rule {
    protocol         = "any"
    port_range       = "all"
    destination_cidr = "0.0.0.0/0"
  }
}

# Web server security group with HTTP/HTTPS/SSH
resource "zillaforge_security_group" "web_servers" {
  name        = "web-servers-prod"
  description = "Security group for production web tier"

  # Allow HTTP from anywhere
  ingress_rule {
    protocol    = "tcp"
    port_range  = "80"
    source_cidr = "0.0.0.0/0"
  }

  # Allow HTTPS from anywhere
  ingress_rule {
    protocol    = "tcp"
    port_range  = "443"
    source_cidr = "0.0.0.0/0"
  }

  # Allow SSH from admin network only
  ingress_rule {
    protocol    = "tcp"
    port_range  = "22"
    source_cidr = "203.0.113.0/24"
  }

  # Allow all outbound traffic (IPv4)
  egress_rule {
    protocol         = "any"
    port_range       = "all"
    destination_cidr = "0.0.0.0/0"
  }

  # Allow all outbound traffic (IPv6)
  egress_rule {
    protocol         = "any"
    port_range       = "all"
    destination_cidr = "::/0"
  }
}

# Database security group with port range
resource "zillaforge_security_group" "database" {
  name        = "database-tier"
  description = "Security group for database servers"

  # Allow PostgreSQL from application subnet
  ingress_rule {
    protocol    = "tcp"
    port_range  = "5432"
    source_cidr = "10.0.2.0/24"
  }

  # Allow MySQL from application subnet
  ingress_rule {
    protocol    = "tcp"
    port_range  = "3306"
    source_cidr = "10.0.2.0/24"
  }

  # Allow Redis cluster ports
  ingress_rule {
    protocol    = "tcp"
    port_range  = "6379-6389"
    source_cidr = "10.0.2.0/24"
  }

  # Allow ICMP (ping) for monitoring
  ingress_rule {
    protocol    = "icmp"
    port_range  = "all"
    source_cidr = "10.0.0.0/16"
  }

  # Allow outbound to application subnet only
  egress_rule {
    protocol         = "tcp"
    port_range       = "all"
    destination_cidr = "10.0.2.0/24"
  }
}

# IPv6-enabled security group
resource "zillaforge_security_group" "ipv6_enabled" {
  name        = "ipv6-web"
  description = "Security group with IPv6 support"

  # HTTP IPv4
  ingress_rule {
    protocol    = "tcp"
    port_range  = "80"
    source_cidr = "0.0.0.0/0"
  }

  # HTTP IPv6
  ingress_rule {
    protocol    = "tcp"
    port_range  = "80"
    source_cidr = "::/0"
  }

  # Egress IPv4
  egress_rule {
    protocol         = "any"
    port_range       = "all"
    destination_cidr = "0.0.0.0/0"
  }

  # Egress IPv6
  egress_rule {
    protocol         = "any"
    port_range       = "all"
    destination_cidr = "::/0"
  }
}

# Output security group ID for reference
output "web_sg_id" {
  description = "Security group ID for web servers"
  value       = zillaforge_security_group.web_servers.id
}

# Example: Referencing security group in VPS instance (future resource)
# This demonstrates the pattern for attaching security groups to instances
# Note: zillaforge_vps_instance resource is not yet implemented
#
# resource "zillaforge_vps_instance" "web_server" {
#   name              = "web-prod-01"
#   flavor_id         = "flavor-uuid-here"
#   security_group_id = zillaforge_security_group.web_servers.id
#
#   # Alternative: Reference by data source lookup
#   # security_group_id = data.zillaforge_security_groups.by_name.security_groups[0].id
# }
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Human-readable name for the security group. Must be unique within the project. **Immutable** - changing this value forces resource replacement.

### Optional

- `description` (String) Optional description providing context about the security group's purpose. This attribute can be updated in-place without recreating the resource.
- `egress_rule` (Block List) Outbound firewall rules that control traffic FROM instances attached to this security group. Rules specify allowed destination traffic by protocol, port range, and destination CIDR block. Empty list denies all outbound traffic. (see [below for nested schema](#nestedblock--egress_rule))
- `ingress_rule` (Block List) Inbound firewall rules that control traffic TO instances attached to this security group. Rules specify allowed source traffic by protocol, port range, and source CIDR block. Empty list denies all inbound traffic (secure by default). (see [below for nested schema](#nestedblock--ingress_rule))

### Read-Only

- `id` (String) Unique identifier for the security group (UUID format). Assigned by the API upon creation.

<a id="nestedblock--egress_rule"></a>
### Nested Schema for `egress_rule`

Required:

- `destination_cidr` (String) Destination CIDR block for allowed outbound traffic. Examples: `0.0.0.0/0` (all IPv4), `10.0.0.0/8` (private network), `::/0` (all IPv6). Both IPv4 and IPv6 are supported.
- `port_range` (String) Port specification. Valid formats: single port (`22`), port range (`8000-8100`), or `all` (equivalent to `1-65535` for TCP/UDP). For ICMP protocol, must be `all`.
- `protocol` (String) Network protocol for this rule. Valid values: `tcp`, `udp`, `icmp`, `any`. Case-insensitive.

Read-Only:

- `source_cidr` (String) Not used for egress rules. Must be null or empty.


<a id="nestedblock--ingress_rule"></a>
### Nested Schema for `ingress_rule`

Required:

- `port_range` (String) Port specification. Valid formats: single port (`22`), port range (`8000-8100`), or `all` (equivalent to `1-65535` for TCP/UDP). For ICMP protocol, must be `all`.
- `protocol` (String) Network protocol for this rule. Valid values: `tcp`, `udp`, `icmp`, `any`. Case-insensitive.
- `source_cidr` (String) Source CIDR block for allowed inbound traffic. Examples: `0.0.0.0/0` (all IPv4), `192.168.1.0/24` (subnet), `::/0` (all IPv6). Both IPv4 and IPv6 are supported.

Read-Only:

- `destination_cidr` (String) Not used for ingress rules. Must be null or empty.

## Import

Import is supported using the following syntax:

```shell
#!/bin/bash
# T063-T064: Import example script for zillaforge_security_group resource

# Import an existing security group by its ID
# The security group must already exist in your ZillaForge account
# You can find the security group ID from the ZillaForge console or API

# Usage:
#   1. Create a security group resource definition in your Terraform configuration:
#
#      resource "zillaforge_security_group" "imported" {
#        name        = "existing-security-group"
#        description = "Security group imported from ZillaForge"
#        
#        # Define rules that match the existing security group
#        ingress_rule {
#          protocol    = "tcp"
#          port_range  = "22"
#          source_cidr = "10.0.0.0/8"
#        }
#      }
#
#   2. Run the import command with the security group ID:

terraform import zillaforge_security_group.imported sg-12345678-1234-1234-1234-123456789abc

# After import:
# - Run `terraform plan` to verify the configuration matches the imported state
# - If there are differences, update your Terraform configuration to match
# - Run `terraform apply` to manage the security group going forward

# Common scenarios:

# Example 1: Import a web security group
# terraform import zillaforge_security_group.web sg-aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa

# Example 2: Import a database security group  
# terraform import zillaforge_security_group.db sg-bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb

# Example 3: Import and verify no changes needed
# terraform import zillaforge_security_group.imported <SECURITY_GROUP_ID>
# terraform plan  # Should show "No changes" if config matches

# Troubleshooting:
# - Error "Invalid Import ID Format": Ensure the ID is a valid UUID format
# - Error "Unable to read security group": Verify the security group exists and you have access
# - Plan shows changes after import: Update your Terraform config to match the actual security group state

# Notes:
# - The import ID must be the security group UUID, not the name
# - All rules (ingress and egress) will be imported
# - After import, Terraform will manage all future changes to the security group
# - The security group must exist before importing (create via UI/API if needed)
```

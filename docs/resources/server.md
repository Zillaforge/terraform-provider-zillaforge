---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "zillaforge_server Resource - zillaforge"
subcategory: ""
description: |-
  Manages a ZillaForge VPS virtual machine instance. Supports create, read, update (in-place for name, description, network attachments), delete, and import operations.
---

# zillaforge_server (Resource)

Manages a ZillaForge VPS virtual machine instance. Supports create, read, update (in-place for name, description, network attachments), delete, and import operations.

## Example Usage

```terraform
// Consolidated examples demonstrating common `zillaforge_server` usage patterns.
// This single file replaces the prior per-feature example files and keeps each
// example focused on the feature it intends to demonstrate.

// Provider configuration (shared by all examples)
terraform {
  required_providers {
    zillaforge = {
      source = "Zillaforge/zillaforge"
    }
  }
}

provider "zillaforge" {
  api_endpoint = "https://api.zillaforge.com"
  api_token    = var.zillaforge_token
}

// ---------------------------------------------------------------------------
// Common data sources
// ---------------------------------------------------------------------------

data "zillaforge_flavors" "available" {}

data "zillaforge_images" "ubuntu" {
  name = "Ubuntu 22.04 LTS"
}

data "zillaforge_networks" "default" {
  name = "default"
}

data "zillaforge_networks" "public" {
  name = "public-network"
}

data "zillaforge_networks" "private" {
  name = "private-network"
}

data "zillaforge_networks" "management" {
  name = "management-network"
}

data "zillaforge_security_groups" "default" {
  name = "default"
}

data "zillaforge_security_groups" "web" {
  name = "web-sg"
}

data "zillaforge_security_groups" "database" {
  name = "database-sg"
}

data "zillaforge_security_groups" "management" {
  name = "management-sg"
}

// ---------------------------------------------------------------------------
// Example 1: Basic server
// Demonstrates minimal required attributes and inspecting outputs
// ---------------------------------------------------------------------------

resource "zillaforge_server" "web" {
  name      = "web-server-01"
  flavor_id = data.zillaforge_flavors.available.flavors[0].id
  image_id  = data.zillaforge_images.ubuntu.images[0].id

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    primary            = true
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
  }
}

output "web_server_id" {
  value = zillaforge_server.web.id
}

output "web_server_ip" {
  value = zillaforge_server.web.ip_addresses
}

// ---------------------------------------------------------------------------
// Example 2: Server with optional attributes
// Demonstrates keypair, cloud-init user_data, wait_for_active and timeouts
// ---------------------------------------------------------------------------

resource "zillaforge_keypair" "admin" {
  name       = "admin-key"
  public_key = file("~/.ssh/id_rsa.pub")
}

resource "zillaforge_server" "app" {
  name        = "app-server-01"
  description = "Application server with optional attributes"

  flavor_id = data.zillaforge_flavors.available.flavors[0].id
  image_id  = data.zillaforge_images.ubuntu.images[0].id

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    primary            = true
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
  }

  keypair = zillaforge_keypair.admin.name

  user_data = base64encode(<<-EOF
    #cloud-config
    package_update: true
    package_upgrade: true
    packages:
      - nginx
    runcmd:
      - systemctl enable nginx
      - systemctl start nginx
  EOF
  )

  wait_for_active = true

  timeouts {
    create = "15m"
    delete = "10m"
  }
}

output "app_server_id" {
  value = zillaforge_server.app.id
}

// ---------------------------------------------------------------------------
// Example 3: Server with multiple network attachments
// Demonstrates multiple NICs, fixed IP, and per-NIC security groups
// ---------------------------------------------------------------------------

resource "zillaforge_server" "database" {
  name        = "db-server-01"
  description = "Database server with multiple networks"

  flavor_id = data.zillaforge_flavors.available.flavors[1].id
  image_id  = data.zillaforge_images.ubuntu.images[0].id

  network_attachment {
    network_id         = data.zillaforge_networks.public.networks[0].id
    primary            = true
    security_group_ids = [data.zillaforge_security_groups.web.security_groups[0].id]
  }

  network_attachment {
    network_id         = data.zillaforge_networks.private.networks[0].id
    ip_address         = "192.168.1.100"
    security_group_ids = [data.zillaforge_security_groups.database.security_groups[0].id]
  }

  network_attachment {
    network_id         = data.zillaforge_networks.management.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.management.security_groups[0].id]
  }
}

output "database_server_ips" {
  value = zillaforge_server.database.ip_addresses
}

// ---------------------------------------------------------------------------
// Example 4: Server with Floating IP association
// Demonstrates associating a `floating_ip` to a network attachment using
// the `floating_ip_id` attribute. The `floating_ip` (read-only) shows the
// public address once associated.
// ---------------------------------------------------------------------------

resource "zillaforge_floating_ip" "example" {
  name = "example-fip"
}

resource "zillaforge_server" "web_with_fip" {
  name      = "web-with-fip"
  flavor_id = data.zillaforge_flavors.available.flavors[0].id
  image_id  = data.zillaforge_images.ubuntu.images[0].id
  password  = "ChangeMe123!"

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    primary            = true
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
    floating_ip_id     = zillaforge_floating_ip.example.id
  }
}

output "web_with_fip_id" {
  value = zillaforge_server.web_with_fip.id
}

output "web_with_fip_address" {
  value = zillaforge_server.web_with_fip.network_attachment[0].floating_ip
}

// ---------------------------------------------------------------------------
// Example 5: Floating IP swap (in-place update)
// Demonstrates swapping a floating IP by changing `floating_ip_id` from one
// floating IP to another â€” the provider will disassociate the old IP then
// associate the new IP without recreating the server.
// ---------------------------------------------------------------------------

resource "zillaforge_floating_ip" "swap_one" { name = "swap-fip-1" }
resource "zillaforge_floating_ip" "swap_two" { name = "swap-fip-2" }

resource "zillaforge_server" "swap_server" {
  name      = "swap-server"
  flavor_id = data.zillaforge_flavors.available.flavors[0].id
  image_id  = data.zillaforge_images.ubuntu.images[0].id
  password  = "ChangeMe123!"

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    primary            = true
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
    floating_ip_id     = zillaforge_floating_ip.swap_one.id
  }
}

# To swap: change `floating_ip_id` to `zillaforge_floating_ip.swap_two.id` and run `terraform apply`

output "swap_server_floating_ip" {
  value = zillaforge_server.swap_server.network_attachment[0].floating_ip
}

// ---------------------------------------------------------------------------
// Example 6: Asynchronous server creation
// Demonstrates `wait_for_active = false` for batch deployments
// ---------------------------------------------------------------------------

resource "zillaforge_server" "batch_server_1" {
  name            = "batch-server-01"
  flavor_id       = data.zillaforge_flavors.available.flavors[0].id
  image_id        = data.zillaforge_images.ubuntu.images[0].id
  password        = "SecurePassword123!"
  wait_for_active = false

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
  }
}

resource "zillaforge_server" "batch_server_2" {
  name            = "batch-server-02"
  flavor_id       = data.zillaforge_flavors.available.flavors[0].id
  image_id        = data.zillaforge_images.ubuntu.images[0].id
  password        = "SecurePassword123!"
  wait_for_active = false

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
  }
}

resource "zillaforge_server" "batch_server_3" {
  name            = "batch-server-03"
  flavor_id       = data.zillaforge_flavors.available.flavors[0].id
  image_id        = data.zillaforge_images.ubuntu.images[0].id
  password        = "SecurePassword123!"
  wait_for_active = false

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
  }
}

output "batch_server_ids" {
  value = [
    zillaforge_server.batch_server_1.id,
    zillaforge_server.batch_server_2.id,
    zillaforge_server.batch_server_3.id,
  ]
}

output "batch_server_statuses" {
  value = {
    server_1 = zillaforge_server.batch_server_1.status
    server_2 = zillaforge_server.batch_server_2.status
    server_3 = zillaforge_server.batch_server_3.status
  }
}

// ---------------------------------------------------------------------------
// Example 5: Demonstrate wait_for_deleted behavior
// ---------------------------------------------------------------------------

resource "zillaforge_server" "web_wait_deleted" {
  name             = "web-wait-deleted"
  flavor_id        = data.zillaforge_flavors.available.flavors[0].id
  image_id         = data.zillaforge_images.ubuntu.images[0].id
  description      = "Server that waits for deletion (default behavior)"
  wait_for_deleted = true

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
    primary            = true
  }

  timeouts {
    delete = "15m"
  }
}

resource "zillaforge_server" "temp_no_wait" {
  name             = "temp-no-wait"
  flavor_id        = data.zillaforge_flavors.available.flavors[0].id
  image_id         = data.zillaforge_images.ubuntu.images[0].id
  description      = "Temporary server that does not wait for deletion"
  wait_for_deleted = false

  network_attachment {
    network_id         = data.zillaforge_networks.default.networks[0].id
    security_group_ids = [data.zillaforge_security_groups.default.security_groups[0].id]
    primary            = true
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `flavor_id` (String) The ID of the flavor (instance type) to use for this server. Defines the virtual CPU count, memory, and root disk size. **Changing this attribute is not supported and will be rejected at plan time.** Use the `zillaforge_flavors` data source to list available flavors.
- `image_id` (String) The ID of the image to use for the server's operating system. **Changing this attribute is not supported and will be rejected at plan time.** Use the `zillaforge_images` data source to list available images.
- `name` (String) The name of the server instance. Must be unique within the project and between 1-255 characters.

### Optional

- `description` (String) A human-readable description of the server. Maximum 1000 characters.
- `keypair` (String) The name of the SSH keypair to inject into the server for authentication. **Changing this attribute is not supported and will be rejected at plan time.** Use the `zillaforge_keypairs` data source to list available keypairs or create a new one with the `zillaforge_keypair` resource.
- `network_attachment` (Block List) Network interfaces to attach to the server. Each block defines a network connection. At least one network attachment is required, and at most one can be marked as `primary=true`. (see [below for nested schema](#nestedblock--network_attachment))
- `password` (String, Sensitive) Password for the server. Must be base64-encoded. **Changing this attribute is not supported and will be rejected at plan time.** This attribute is sensitive and will not appear in logs or plan output.
- `timeouts` (Block, Optional) Configurable timeouts for create, update, and delete operations. (see [below for nested schema](#nestedblock--timeouts))
- `user_data` (String, Sensitive) Cloud-init user data for configuring the server on first boot. Must be base64-encoded (use Terraform's `base64encode()` function). Maximum size 64KB. **Changing this attribute is not supported and will be rejected at plan time.** The user data is not returned by the API for security reasons, so it will not appear in state after import.
- `wait_for_active` (Boolean) Whether to wait for the server to reach `active` status after creation. **This value is used only during create/apply and is not stored in state; changing it does not trigger resource updates.** When set to `true` (default), Terraform will poll the server status until it reaches `active` state or the timeout is exceeded. When set to `false`, Terraform will return immediately after the API responds, without waiting for the server to become active. Default is `true`.
- `wait_for_deleted` (Boolean) Whether to wait for the server to be fully deleted. **This value is used only during delete/apply and is not stored in state; changing it does not trigger resource updates.** When set to `true` (default), Terraform will poll the server status until it is fully deleted or the timeout is exceeded. When set to `false`, Terraform will return immediately after the delete API call, without waiting for the server deletion to complete. Default is `true`.

### Read-Only

- `created_at` (String) The timestamp when the server was created, in RFC3339 format (e.g., `2023-10-15T14:30:00Z`).
- `id` (String) The unique identifier for the server instance. Generated by the platform.
- `ip_addresses` (List of String) List of IP addresses assigned to the server. The order corresponds to the order of `network_attachment` blocks. Includes both DHCP-assigned and fixed IP addresses.
- `status` (String) The current status of the server. Possible values: `building` (instance is being created), `active` (instance is running and ready), `error` (instance entered an error state), `deleted` (instance has been deleted).

<a id="nestedblock--network_attachment"></a>
### Nested Schema for `network_attachment`

Required:

- `network_id` (String) The ID of the network to attach. Use the `zillaforge_networks` data source to list available networks.

Optional:

- `floating_ip_id` (String) UUID of the floating IP to associate with this network interface. When specified, the floating IP will be associated with this network attachment. Remove this attribute or set to null to disassociate the floating IP. Note: The floating IP must exist and not be associated with another server.
- `ip_address` (String) Optional fixed IPv4 address to assign to this network interface. If not specified, an IP address will be automatically assigned via DHCP. Must be a valid IPv4 address within the network's CIDR range.
- `primary` (Boolean) Whether this is the primary network interface for the server. At most one network attachment can have `primary=true`. The primary interface is used for default routing.
- `security_group_ids` (List of String) List of security group IDs to apply to this network interface. Use the `zillaforge_security_groups` data source to list available security groups.

Read-Only:

- `floating_ip` (String) The public IP address of the floating IP associated with this network interface. This is a read-only attribute that displays the IP address corresponding to floating_ip_id. Empty when no floating IP is associated.


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String) Maximum time to wait for server creation to complete. Default is `10m` (10 minutes). Use Go duration syntax (e.g., `15m`, `1h`).
- `delete` (String) Maximum time to wait for server deletion to complete. Default is `10m` (10 minutes). Use Go duration syntax (e.g., `15m`, `1h`).
- `update` (String) Maximum time to wait for server update to complete. Default is `10m` (10 minutes). Use Go duration syntax (e.g., `15m`, `1h`).

## Import

Import is supported using the following syntax:

```shell
#!/bin/bash
# Example: Import an existing ZillaForge VPS server into Terraform state
#
# Usage:
#   ./import.sh <server-id>
#
# Prerequisites:
#   1. Existing server in ZillaForge platform
#   2. Terraform configuration file matching the server's actual configuration
#   3. ZillaForge provider configured with valid credentials
#
# Example:
#   ./import.sh 550e8400-e29b-41d4-a716-446655440000

set -e

if [ $# -eq 0 ]; then
    echo "Error: Server ID required"
    echo "Usage: $0 <server-id>"
    echo ""
    echo "Example:"
    echo "  $0 550e8400-e29b-41d4-a716-446655440000"
    exit 1
fi

SERVER_ID="$1"

# Verify server exists before attempting import
echo "Verifying server ${SERVER_ID} exists..."

# Import the server into Terraform state
echo "Importing server ${SERVER_ID} into Terraform state..."
terraform import zillaforge_server.imported "${SERVER_ID}"

echo ""
echo "Import successful!"
echo ""
echo "Next steps:"
echo "  1. Run 'terraform plan' to verify configuration matches imported state"
echo "  2. Update your configuration if there are any differences"
echo "  3. Run 'terraform apply' to confirm no changes are needed"
echo ""
echo "Note: The following attributes are not imported from the API (for security):"
echo "  - user_data: Set to null after import"
echo "  - password: Set to null after import"
echo ""
echo "If your server was created with user_data or password, you'll need to:"
echo "  - Remove these attributes from your configuration, OR"
echo "  - Use 'lifecycle { ignore_changes = [user_data, password] }' to prevent drift"
```
